## Access Control

# Always listen for upstream server(s).
interface       listen all

{% if inventory_hostname in groups['time-server'] %}
# Server:  Allow service and query packets from anywhere:
restrict        default nomodify nopeer limited
{% else %}
# Client:  Allow service packets from upstream server(s):
restrict        default ignore
{% for server in groups['time-server'] %}
restrict        {{ server }}.{{ domain }} nomodify nopeer noquery limited
{% endfor %}
restrict        pool.ntp.org nomodify nopeer noquery limited
restrict        0.debian.pool.ntp.org nomodify nopeer noquery limited
restrict        1.debian.pool.ntp.org nomodify nopeer noquery limited
restrict        2.debian.pool.ntp.org nomodify nopeer noquery limited
restrict        3.debian.pool.ntp.org nomodify nopeer noquery limited
{% endif %}

# Unrestrict local access:
restrict        127.0.0.1
restrict        ::1


## Upstream server(s):
{% if inventory_hostname in groups['time-server'] %}
pool            pool.ntp.org burst
pool            0.debian.pool.ntp.org iburst burst
pool            1.debian.pool.ntp.org iburst burst
pool            2.debian.pool.ntp.org iburst burst
pool            3.debian.pool.ntp.org iburst burst
{% else %}
{% for server in groups['time-server'] %}
server          {{ server }}.{{ domain }} iburst burst
{% endfor %}
{% endif %}


## Other options:
driftfile       /var/lib/ntp/ntp.drift
statistics      loopstats peerstats clockstats
filegen         loopstats file loopstats type day enable
filegen         peerstats file peerstats type day enable
filegen         clockstats file clockstats type day enable
{% if inventory_hostname not in groups['time-server'] %}
# Set the clock even if it is a big jump.  Might not be necessary if something like step-tickers is implemented.
# tinker          panic 0
{% endif %}

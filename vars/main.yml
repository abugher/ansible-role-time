---
install_packages:
  - 'cron'
  - 'ntpsec'
# https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1049424
create_files:
  - owner:              'root'
    group:              'ntpsec'
    mode:               '0775'
    path:               '/var/log/ntpsec'
    state:              'directory'
template_files:
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/templates/timezone.j2"
    dest:               '/etc/timezone'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                'templates/ntp.conf.j2'
    dest:               '/etc/ntpsec/ntp.conf'
symlinks:
  - owner:              'root'
    group:              'root'
    src:                "/usr/share/zoneinfo/{{ timezone }}"
    dest:               '/etc/localtime'
  - owner:              'root'
    group:              'root'
    src:                '/etc/ntpsec/ntp.conf'
    dest:               '/etc/ntp.conf'
enable_services:        "{{ install_packages }}"
start_services:         "{{ install_packages }}"
# WARNING:  On DHCP client systems, /run/ntpsec/ntp.conf.dhcp is generated from
# /etc/ntpsec/ntp.conf by the DHCP client and used automatically by ntpsec.  As
# a result, restarting ntpsec will not kick in new configuration until after a
# DHCP client reload or restart, or until the next "DHCP event".
restart_services:       "{{ install_packages }}"
